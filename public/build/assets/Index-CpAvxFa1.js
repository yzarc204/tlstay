import{x as H,r as R,H as q,c as r,k as V,d as e,e as m,t as d,a as g,b as y,g as k,f as T,v as j,l as w,o,h as P,w as A,y as N,j as M,F as b,i as _,n as U,q as B}from"./app-Bt1z262F.js";import{b as E,_ as F}from"./AdminLayout-BWBzxaGH.js";import{_ as I}from"./SelectSearchable-bf6AmCNH.js";import{a as L,u as X}from"./FlashToaster-Cms5pOrK.js";import{u as K}from"./useConfirm-CJ45mfKP.js";import{r as Q}from"./StarIcon-C6jeih8K.js";import{r as z}from"./TrashIcon-CTlhtgkE.js";/* empty css            */import"./MapPinIcon-BbjlIJa0.js";import"./CalendarIcon-BObuev7c.js";import"./PhotoIcon-XxQ97rfc.js";import"./BuildingOfficeIcon-BL8SXywi.js";import"./ChevronUpDownIcon-OBFFn-rE.js";const G={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},O={class:"p-6"},J={class:"flex items-center justify-between mb-4"},W={class:"text-xl font-bold text-gray-900"},Y={key:0,class:"mt-1 text-sm text-red-600"},Z={class:"flex justify-end space-x-3"},ee=["disabled"],se={key:0},te={key:1},ne={key:1,class:"space-y-4"},oe={key:0,class:"mt-1 text-sm text-red-600"},re={class:"flex justify-end space-x-3"},ae=["disabled"],le={key:0},ie={key:1},D={__name:"ManagerResponseForm",props:{reviewId:{type:Number,required:!0},initialResponse:{type:String,default:null},showAsModal:{type:Boolean,default:!1}},emits:["response-sent","cancel"],setup(a,{emit:$}){const l=a,C=$,{showToast:x}=X(),i=H({manager_response:l.initialResponse||""}),c=R(!1),u=R({});q(()=>l.initialResponse,p=>{i.manager_response=p||""});const f=()=>{i.manager_response=l.initialResponse||"",u.value={}},v=()=>{if(!i.manager_response.trim()){u.value.manager_response="Vui lòng nhập phản hồi";return}c.value=!0,u.value={};const p=l.initialResponse?`/admin/reviews/${l.reviewId}/response`:`/admin/reviews/${l.reviewId}/respond`,t=l.initialResponse?{...i,_method:"PUT"}:i;w.post(p,t,{preserveScroll:!0,onSuccess:()=>{x(l.initialResponse?"Phản hồi đã được cập nhật!":"Phản hồi đã được gửi thành công!","success"),f(),C("response-sent")},onError:s=>{u.value=s,s.error&&x(s.error,"error")},onFinish:()=>{c.value=!1}})};return(p,t)=>(o(),r("div",null,[a.showAsModal?(o(),r("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:t[3]||(t[3]=V(s=>p.$emit("cancel"),["self"]))},[e("div",G,[e("div",O,[e("div",J,[e("h3",W,d(a.initialResponse?"Chỉnh sửa phản hồi":"Phản hồi đánh giá"),1),a.showAsModal?(o(),r("button",{key:0,onClick:t[0]||(t[0]=s=>p.$emit("cancel")),class:"text-gray-400 hover:text-gray-600"},[g(y(L),{class:"w-6 h-6"})])):m("",!0)]),e("form",{onSubmit:V(v,["prevent"]),class:"space-y-4"},[e("div",null,[t[5]||(t[5]=e("label",{for:"response",class:"block text-sm font-medium text-gray-700 mb-2"},[T(" Phản hồi "),e("span",{class:"text-red-500"},"*")],-1)),k(e("textarea",{id:"response","onUpdate:modelValue":t[1]||(t[1]=s=>i.manager_response=s),rows:"6",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Nhập phản hồi của bạn...",required:""},null,512),[[j,i.manager_response]]),u.value.manager_response?(o(),r("p",Y,d(u.value.manager_response),1)):m("",!0)]),e("div",Z,[a.showAsModal?(o(),r("button",{key:0,type:"button",onClick:t[2]||(t[2]=s=>p.$emit("cancel")),class:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"}," Hủy ")):m("",!0),e("button",{type:"submit",disabled:c.value,class:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed"},[c.value?(o(),r("span",se,"Đang gửi...")):(o(),r("span",te,d(a.initialResponse?"Cập nhật":"Gửi phản hồi"),1))],8,ee)])],32)])])])):(o(),r("div",ne,[e("div",null,[t[6]||(t[6]=e("label",{for:"response",class:"block text-sm font-medium text-gray-700 mb-2"},[T(" Phản hồi đánh giá "),e("span",{class:"text-red-500"},"*")],-1)),k(e("textarea",{id:"response","onUpdate:modelValue":t[4]||(t[4]=s=>i.manager_response=s),rows:"4",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Nhập phản hồi của bạn...",required:""},null,512),[[j,i.manager_response]]),u.value.manager_response?(o(),r("p",oe,d(u.value.manager_response),1)):m("",!0)]),e("div",re,[e("button",{type:"button",onClick:f,class:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 text-sm"}," Hủy "),e("button",{type:"submit",onClick:v,disabled:c.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed text-sm"},[c.value?(o(),r("span",le,"Đang gửi...")):(o(),r("span",ie,"Gửi phản hồi"))],8,ae)])]))]))}},de={class:"space-y-6"},ce={class:"bg-white rounded-lg shadow-sm p-4"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},pe={key:0,class:"space-y-4"},me={class:"flex items-start justify-between mb-4"},ge={class:"flex items-center space-x-4 flex-1"},he={class:"w-12 h-12 rounded-full bg-primary-100 flex items-center justify-center"},ye={class:"text-primary font-semibold"},fe={class:"flex-1"},be={class:"font-semibold text-gray-800"},xe={class:"text-sm text-gray-500"},ve={class:"text-sm text-gray-600"},_e={class:"flex items-center space-x-3"},we={class:"flex items-center space-x-1"},ke=["onClick"],$e={key:0,class:"text-gray-700 mb-4 whitespace-pre-wrap"},Ce={key:1,class:"grid grid-cols-4 gap-2 mb-4"},Re=["onClick"],Se=["src","alt"],Ve={key:2,class:"mt-4 pt-4 border-t border-gray-200 bg-gray-50 rounded-lg p-4"},Te={class:"flex items-start justify-between"},je={class:"flex-1"},Ne={class:"flex items-center space-x-2 mb-2"},Me={key:0,class:"text-xs text-gray-500"},Ue={class:"text-gray-700 whitespace-pre-wrap"},De=["onClick"],He={key:3,class:"mt-4 pt-4 border-t border-gray-200"},qe={key:0,class:"flex justify-center"},Pe={class:"flex space-x-2"},Ae={key:1,class:"bg-white rounded-lg shadow-sm p-12 text-center"},Ze={__name:"Index",props:{reviews:{type:Object,required:!0},houses:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(a){const $=a,l=R(null),C=K(),x=t=>{if(!t?.name)return"K";const s=t.name.split(" ");return s.length>=2?(s[0][0]+s[s.length-1][0]).toUpperCase():t.name[0].toUpperCase()},i=t=>t?new Date(t).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",c=()=>{w.get("/admin/reviews",$.filters,{preserveState:!0,preserveScroll:!0})},u=t=>{l.value=t},f=()=>{l.value=null,w.reload({only:["reviews"]})},v=t=>{window.open(t,"_blank")},p=async t=>{try{await C.show({title:"Xóa đánh giá",message:`Bạn có chắc chắn muốn xóa đánh giá của "${t.user?.name||"Khách hàng"}"?

Hành động này sẽ xóa đánh giá và tất cả ảnh liên quan. Hành động này không thể hoàn tác.`,confirmText:"Xóa",cancelText:"Hủy",confirmVariant:"danger"}),w.delete(`/admin/reviews/${t.id}`,{preserveScroll:!0,onSuccess:()=>{}})}catch(s){s.message!=="USER_CANCELLED"&&console.error("Error showing confirm dialog:",s)}};return(t,s)=>(o(),r(b,null,[g(y(P),{title:"Quản lý Đánh giá"}),g(F,{title:"Quản lý Đánh giá"},{default:A(()=>[e("div",de,[s[11]||(s[11]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Quản lý Đánh giá"),e("p",{class:"text-gray-600 mt-1"},"Xem và phản hồi các đánh giá từ khách hàng")],-1)),e("div",ce,[e("div",ue,[e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Nhà trọ ",-1)),g(I,{modelValue:a.filters.house_id,"onUpdate:modelValue":[s[0]||(s[0]=n=>a.filters.house_id=n),c],options:a.houses,"option-value":"id","option-label":"name",placeholder:"Tất cả nhà trọ..."},null,8,["modelValue","options"])]),e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Số sao ",-1)),k(e("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>a.filters.rating=n),onChange:c,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"},[...s[5]||(s[5]=[e("option",{value:""},"Tất cả",-1),e("option",{value:"5"},"5 sao",-1),e("option",{value:"4"},"4 sao",-1),e("option",{value:"3"},"3 sao",-1),e("option",{value:"2"},"2 sao",-1),e("option",{value:"1"},"1 sao",-1)])],544),[[M,a.filters.rating]])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Trạng thái phản hồi ",-1)),k(e("select",{"onUpdate:modelValue":s[2]||(s[2]=n=>a.filters.has_response=n),onChange:c,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"},[...s[7]||(s[7]=[e("option",{value:""},"Tất cả",-1),e("option",{value:"1"},"Đã phản hồi",-1),e("option",{value:"0"},"Chưa phản hồi",-1)])],544),[[M,a.filters.has_response]])])])]),a.reviews.data&&a.reviews.data.length>0?(o(),r("div",pe,[(o(!0),r(b,null,_(a.reviews.data,n=>(o(),r("div",{key:n.id,class:"bg-white rounded-lg shadow-sm p-6"},[e("div",me,[e("div",ge,[e("div",he,[e("span",ye,d(x(n.user)),1)]),e("div",fe,[e("p",be,d(n.user?.name||"Khách hàng"),1),e("p",xe,d(i(n.created_at)),1),e("p",ve,"Nhà trọ: "+d(n.house?.name),1)])]),e("div",_e,[e("div",we,[(o(),r(b,null,_(5,h=>g(y(Q),{key:h,class:U(["w-5 h-5",h<=n.rating?"text-yellow-400 fill-current":"text-gray-300"])},null,8,["class"])),64))]),e("button",{onClick:h=>p(n),class:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Xóa đánh giá"},[g(y(z),{class:"w-5 h-5"})],8,ke)])]),n.comment?(o(),r("p",$e,d(n.comment),1)):m("",!0),n.images&&n.images.length>0?(o(),r("div",Ce,[(o(!0),r(b,null,_(n.images,(h,S)=>(o(),r("div",{key:S,class:"aspect-square rounded-lg overflow-hidden border border-gray-200 cursor-pointer hover:opacity-90",onClick:Be=>v(h)},[e("img",{src:h,alt:`Review image ${S+1}`,class:"w-full h-full object-cover"},null,8,Se)],8,Re))),128))])):m("",!0),n.manager_response?(o(),r("div",Ve,[e("div",Te,[e("div",je,[e("div",Ne,[s[9]||(s[9]=e("span",{class:"font-semibold text-secondary"},"Phản hồi của bạn",-1)),n.manager_response_at?(o(),r("span",Me,d(i(n.manager_response_at)),1)):m("",!0)]),e("p",Ue,d(n.manager_response),1)]),e("button",{onClick:h=>u(n),class:"ml-4 text-primary hover:text-primary-dark text-sm font-medium"}," Chỉnh sửa ",8,De)])])):(o(),r("div",He,[g(D,{"review-id":n.id,onResponseSent:f},null,8,["review-id"])]))]))),128)),a.reviews.links&&a.reviews.links.length>3?(o(),r("div",qe,[e("div",Pe,[(o(!0),r(b,null,_(a.reviews.links,n=>(o(),N(y(B),{key:n.label,href:n.url||"#",class:U(["px-4 py-2 rounded-lg border",n.active?"bg-primary text-white border-primary":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50",n.url?"":"opacity-50 cursor-not-allowed"]),innerHTML:n.label},null,8,["href","class","innerHTML"]))),128))])])):m("",!0)])):(o(),r("div",Ae,[g(y(E),{class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),s[10]||(s[10]=e("p",{class:"text-gray-600 text-lg"},"Chưa có đánh giá nào",-1))]))]),l.value?(o(),N(D,{key:0,"review-id":l.value.id,"initial-response":l.value.manager_response,onResponseSent:f,onCancel:s[3]||(s[3]=n=>l.value=null)},null,8,["review-id","initial-response"])):m("",!0)]),_:1})],64))}};export{Ze as default};
