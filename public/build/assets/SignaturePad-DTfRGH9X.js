import{d as J}from"./FlashToaster-hPDfO9im.js";import{r as b,A as I,z as L,B as W,c,d as r,e as f,f as F,t as D,n as G,o as h}from"./app-BdvrGfPi.js";const H={class:"signature-pad-container"},K={class:"mb-4"},O={class:"block text-sm font-medium text-gray-700 mb-2"},Q={key:0,class:"text-red-500"},Z={key:0,class:"text-xs text-gray-500 mb-2"},$=["width","height"],ee={key:0,class:"absolute inset-0 flex items-center justify-center pointer-events-none"},te={key:0,class:"mt-1 text-sm text-red-600"},ae={class:"mt-3 flex gap-2"},oe=["disabled"],ne={key:1,class:"mt-3 p-3 bg-gray-50 rounded-lg border"},se={class:"bg-white p-4 rounded border border-gray-300 inline-block"},le=["src"],re={__name:"SignaturePad",props:{modelValue:{type:String,default:""},width:{type:Number,default:600},height:{type:Number,default:200},label:{type:String,default:"Chữ ký"},hint:{type:String,default:"Vẽ chữ ký của bạn bằng chuột hoặc ngón tay"},required:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},errorMessage:{type:String,default:""},showPreview:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(s,{emit:R}){const x=s,w=R,a=b(null),k=b(!1),M=b(0),V=b(0),p=b(!1);let o=null;const C=I(()=>!!x.modelValue),E=I(()=>x.modelValue);L(()=>{a.value&&(o=a.value.getContext("2d",{alpha:!0}),o.strokeStyle="#000000",o.lineWidth=2,o.lineCap="round",o.lineJoin="round",o.clearRect(0,0,a.value.width,a.value.height),x.modelValue&&_(x.modelValue))}),W(()=>x.modelValue,e=>{e&&a.value&&o?_(e):!e&&a.value&&o&&B()});const _=e=>{const t=new Image;t.onload=()=>{if(o&&a.value){o.clearRect(0,0,a.value.width,a.value.height);const g=(a.value.width-t.width)/2,i=(a.value.height-t.height)/2;o.drawImage(t,g,i)}},t.src=e},B=()=>{o&&a.value&&o.clearRect(0,0,a.value.width,a.value.height)},X=e=>{const t=a.value.getBoundingClientRect(),g=a.value.width/t.width,i=a.value.height/t.height;return e.touches&&e.touches.length>0?{x:(e.touches[0].clientX-t.left)*g,y:(e.touches[0].clientY-t.top)*i}:{x:(e.clientX-t.left)*g,y:(e.clientY-t.top)*i}},P=e=>{e.preventDefault(),k.value=!0;const t=X(e);M.value=t.x,V.value=t.y},T=e=>{if(!k.value||!o)return;e.preventDefault();const t=X(e);o.beginPath(),o.moveTo(M.value,V.value),o.lineTo(t.x,t.y),o.stroke(),M.value=t.x,V.value=t.y},Y=e=>{e.preventDefault(),P(e)},N=e=>{e.preventDefault(),T(e)},S=()=>{k.value&&(k.value=!1,z())},q=e=>{const i=e.getContext("2d").getImageData(0,0,e.width,e.height).data;let d=e.width,n=e.height,l=0,m=0;for(let u=0;u<e.height;u++)for(let y=0;y<e.width;y++){const A=(u*e.width+y)*4;i[A+3]>0&&(d=Math.min(d,y),n=Math.min(n,u),l=Math.max(l,y),m=Math.max(m,u))}const v=10;return d=Math.max(0,d-v),n=Math.max(0,n-v),l=Math.min(e.width,l+v),m=Math.min(e.height,m+v),{x:d,y:n,width:l-d,height:m-n}},z=()=>{if(!a.value)return;const e=a.value,i=e.getContext("2d").getImageData(0,0,e.width,e.height).data;let d=!1;for(let u=3;u<i.length;u+=4)if(i[u]>0){d=!0;break}if(!d){w("update:modelValue","");return}const n=q(e);if(n.width<=0||n.height<=0){w("update:modelValue","");return}const l=document.createElement("canvas");l.width=n.width,l.height=n.height,l.getContext("2d").drawImage(e,n.x,n.y,n.width,n.height,0,0,n.width,n.height);const v=l.toDataURL("image/png");w("update:modelValue",v)},U=()=>{B(),w("update:modelValue",""),p.value=!1},j=()=>{p.value=!p.value};return(e,t)=>(h(),c("div",H,[r("div",K,[r("label",O,[F(D(s.label)+" ",1),s.required?(h(),c("span",Q,"*")):f("",!0)]),s.hint?(h(),c("p",Z,D(s.hint),1)):f("",!0)]),r("div",{class:G(["border-2 border-gray-300 rounded-lg bg-white relative",{"border-red-500":s.hasError}])},[r("canvas",{ref_key:"canvasRef",ref:a,width:s.width,height:s.height,class:"cursor-crosshair touch-none",onMousedown:P,onMousemove:T,onMouseup:S,onMouseleave:S,onTouchstart:Y,onTouchmove:N,onTouchend:S},null,40,$),C.value?f("",!0):(h(),c("div",ee,[...t[0]||(t[0]=[r("p",{class:"text-gray-400 text-sm"},"Vẽ chữ ký của bạn ở đây",-1)])]))],2),s.hasError?(h(),c("div",te,D(s.errorMessage),1)):f("",!0),r("div",ae,[r("button",{type:"button",onClick:U,class:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:!C.value}," Xóa ",8,oe),s.showPreview&&C.value?(h(),c("button",{key:0,type:"button",onClick:j,class:"px-4 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"},D(p.value?"Ẩn":"Xem")+" xem trước ",1)):f("",!0)]),p.value&&C.value?(h(),c("div",ne,[t[1]||(t[1]=r("p",{class:"text-xs text-gray-600 mb-2"},"Xem trước:",-1)),r("div",se,[r("img",{src:E.value,alt:"Chữ ký",class:"max-w-full h-auto",style:{background:"repeating-conic-gradient(#f0f0f0 0% 25%, white 0% 50%) 50% / 20px 20px"}},null,8,le)])])):f("",!0)]))}},ce=J(re,[["__scopeId","data-v-cb869783"]]);export{ce as S};
