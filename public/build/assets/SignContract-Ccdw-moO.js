import{r as x,p as D,A as C,z as P,c as i,a as d,b as s,h as S,w as v,d as t,e as p,t as a,o as l,f as u,k as $,g as F,s as T,q as M,F as N,l as j}from"./app-ppQx7_BQ.js";import{_ as q}from"./AppLayout-Dce57s_x.js";import{S as B}from"./SignaturePad-Da6wvC_M.js";import{a as E,r as L}from"./InformationCircleIcon-BFmGpIO5.js";import{r as K}from"./ExclamationCircleIcon-BxyR0s1E.js";/* empty css            */import"./auth-Dd3eNE4X.js";import"./FlashToaster-DRaP0e7V.js";import"./ChevronDownIcon-DduOYqOw.js";import"./UserIcon-CSwJth4e.js";import"./DocumentTextIcon-BKIo3o-k.js";import"./PhoneIcon-CjeMPSAD.js";import"./EnvelopeIcon-5t1JJDL_.js";const U={class:"sign-contract bg-light min-h-screen py-12"},X={class:"container mx-auto px-4 max-w-4xl"},z={class:"card p-6 mb-6"},A={class:"grid md:grid-cols-2 gap-4"},H={class:"font-semibold text-gray-900 font-mono"},I={key:0,class:"text-xs text-gray-500 mt-0.5"},O={class:"font-semibold text-gray-900"},G={class:"font-semibold text-gray-900"},J={class:"font-semibold text-gray-900"},Q={class:"card p-6 mb-6"},R={class:"flex items-center justify-between mb-4"},W=["href"],Y={class:"border-2 border-gray-200 rounded-lg overflow-hidden bg-gray-50"},Z={class:"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-end"},tt=["href"],et={key:0,class:"flex items-center justify-center h-96"},st={key:1,class:"p-8 text-center"},rt={class:"text-red-600 mb-4"},ot={class:"flex gap-3 justify-center"},nt=["href"],at={key:2,class:"pdf-viewer-container bg-gray-100",style:{height:"800px",overflow:"auto"}},it=["src"],lt={class:"card p-6"},dt={class:"flex items-start"},ct={key:0,class:"text-sm text-red-600"},gt={key:1,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},mt={class:"text-sm text-red-600"},ut={class:"flex flex-col sm:flex-row gap-4 pt-4"},bt=["disabled"],ht={key:0},xt={key:1},pt={class:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-6"},ft={class:"flex items-start"},Mt={__name:"SignContract",props:{booking:{type:Object,required:!0}},setup(r){const b=r,m=x(""),c=x(!0),g=x(""),o=D({signature:"",agree:!1}),y=C(()=>`/contract/${b.booking.id}?embed=true`),k=()=>{c.value=!1,g.value=""},_=()=>{c.value=!1,g.value="Không thể tải hợp đồng. Vui lòng thử lại hoặc tải PDF để xem."},w=()=>{c.value=!0,g.value="";const n=document.querySelector(".pdf-viewer-container iframe");n&&(n.src=n.src)};P(()=>{setTimeout(()=>{c.value&&(c.value=!1)},1e4)});const f=n=>n?new Date(n).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}):"",V=()=>{m.value="",o.post(`/contract/${b.booking.id}/sign`,{preserveScroll:!0,onSuccess:()=>{j.visit(`/booking/${b.booking.id}/success`,{data:{signed:!0}})},onError:n=>{console.error("Sign contract errors:",n),n.message&&(m.value=n.message)}})};return(n,e)=>(l(),i(N,null,[d(s(S),{title:"Ký hợp đồng"}),d(q,null,{default:v(()=>[t("div",U,[t("div",X,[e[16]||(e[16]=t("div",{class:"text-center mb-8"},[t("h1",{class:"text-4xl font-bold text-secondary mb-2"},"Ký hợp đồng thuê trọ"),t("p",{class:"text-gray-600"},"Vui lòng ký hợp đồng để hoàn tất thủ tục")],-1)),t("div",z,[e[6]||(e[6]=t("h2",{class:"text-xl font-bold text-secondary mb-4"},"Thông tin đặt phòng",-1)),t("div",A,[t("div",null,[e[2]||(e[2]=t("p",{class:"text-sm text-gray-500 mb-1"},"Mã đặt phòng",-1)),t("p",H,a(r.booking.booking_code||`#${r.booking.id}`),1),r.booking.booking_code?(l(),i("p",I,"ID: #"+a(r.booking.id),1)):p("",!0)]),t("div",null,[e[3]||(e[3]=t("p",{class:"text-sm text-gray-500 mb-1"},"Nhà trọ",-1)),t("p",O,a(r.booking.house_name),1)]),t("div",null,[e[4]||(e[4]=t("p",{class:"text-sm text-gray-500 mb-1"},"Phòng",-1)),t("p",G," Phòng "+a(r.booking.room_number)+" - Tầng "+a(r.booking.floor),1)]),t("div",null,[e[5]||(e[5]=t("p",{class:"text-sm text-gray-500 mb-1"},"Thời gian thuê",-1)),t("p",J,a(f(r.booking.start_date))+" - "+a(f(r.booking.end_date)),1)])])]),t("div",Q,[t("div",R,[e[8]||(e[8]=t("h2",{class:"text-xl font-bold text-secondary"},"Xem trước hợp đồng",-1)),t("a",{href:`/contract/${r.booking.id}`,target:"_blank",class:"text-primary hover:text-secondary text-sm font-medium flex items-center"},[d(s(E),{class:"w-4 h-4 mr-1"}),e[7]||(e[7]=u(" Tải PDF ",-1))],8,W)]),t("div",Y,[t("div",Z,[t("a",{href:`/contract/${r.booking.id}`,target:"_blank",class:"text-sm text-primary hover:text-secondary font-medium flex items-center"},[...e[9]||(e[9]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),u(" Mở trong tab mới ",-1)])],8,tt)]),c.value?(l(),i("div",et,[...e[10]||(e[10]=[t("div",{class:"text-center"},[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent mb-4"}),t("p",{class:"text-gray-600"},"Đang tải hợp đồng...")],-1)])])):g.value?(l(),i("div",st,[d(s(K),{class:"w-12 h-12 text-red-500 mx-auto mb-4"}),t("p",rt,a(g.value),1),t("div",ot,[t("button",{onClick:w,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors"}," Thử lại "),t("a",{href:`/contract/${r.booking.id}`,target:"_blank",class:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"}," Tải PDF ",8,nt)])])):(l(),i("div",at,[t("iframe",{src:y.value,class:"w-full h-full",style:{border:"none","min-height":"800px"},onLoad:k,onError:_},null,40,it)]))]),e[11]||(e[11]=t("p",{class:"text-xs text-gray-500 mt-3 text-center"}," Vui lòng đọc kỹ hợp đồng trước khi ký. Bạn có thể tải PDF để xem chi tiết hơn. ",-1))]),t("div",lt,[e[14]||(e[14]=t("h2",{class:"text-xl font-bold text-secondary mb-4"},"Ký hợp đồng",-1)),t("form",{onSubmit:$(V,["prevent"]),class:"space-y-6"},[d(B,{modelValue:s(o).signature,"onUpdate:modelValue":e[0]||(e[0]=h=>s(o).signature=h),"has-error":!!s(o).errors.signature,"error-message":s(o).errors.signature,label:"Chữ ký của bạn",hint:"Vẽ chữ ký của bạn bằng chuột hoặc ngón tay trên vùng bên dưới",required:""},null,8,["modelValue","has-error","error-message"]),t("div",dt,[F(t("input",{id:"agree","onUpdate:modelValue":e[1]||(e[1]=h=>s(o).agree=h),type:"checkbox",class:"mt-1 w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary",required:""},null,512),[[T,s(o).agree]]),e[12]||(e[12]=t("label",{for:"agree",class:"ml-3 text-sm text-gray-700"},[u(" Tôi đã đọc và đồng ý với tất cả các điều khoản trong hợp đồng thuê trọ này. "),t("span",{class:"text-red-500"},"*")],-1))]),s(o).errors.agree?(l(),i("p",ct,a(s(o).errors.agree),1)):p("",!0),m.value?(l(),i("div",gt,[t("p",mt,a(m.value),1)])):p("",!0),t("div",ut,[t("button",{type:"submit",disabled:s(o).processing||!s(o).signature||!s(o).agree,class:"flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed"},[s(o).processing?(l(),i("span",xt,"Đang xử lý...")):(l(),i("span",ht,"Xác nhận và ký hợp đồng"))],8,bt),d(s(M),{href:`/booking/${r.booking.id}/success`,class:"flex-1 btn-outline text-center"},{default:v(()=>[...e[13]||(e[13]=[u(" Hủy ",-1)])]),_:1},8,["href"])])],32)]),t("div",pt,[t("div",ft,[d(s(L),{class:"w-6 h-6 text-blue-600 mr-3 mt-0.5 flex-shrink-0"}),e[15]||(e[15]=t("div",null,[t("h3",{class:"text-lg font-semibold text-blue-900 mb-2"},"Lưu ý quan trọng"),t("ul",{class:"space-y-2 text-blue-800 text-sm"},[t("li",{class:"flex items-start"},[t("span",{class:"mr-2"},"•"),t("span",null," Chữ ký của bạn sẽ được lưu trữ và hiển thị trên hợp đồng PDF ")]),t("li",{class:"flex items-start"},[t("span",{class:"mr-2"},"•"),t("span",null," Sau khi ký, hợp đồng sẽ có hiệu lực pháp lý ")]),t("li",{class:"flex items-start"},[t("span",{class:"mr-2"},"•"),t("span",null," Bạn có thể tải hợp đồng đã ký bất cứ lúc nào trong lịch sử thuê ")]),t("li",{class:"flex items-start"},[t("span",{class:"mr-2"},"•"),t("span",null," Vui lòng đảm bảo chữ ký của bạn rõ ràng và khớp với chữ ký trên CMND/CCCD ")])])],-1))])])])])]),_:1})],64))}};export{Mt as default};
