import{r as x,x as N,c as r,d as e,e as m,f as q,F as b,i as _,a as p,n as I,b as f,t as u,g as R,v as T,k as B,l as E,o as a,A as M}from"./app-Q4frB4sj.js";import{a as S,u as U}from"./FlashToaster-pcLPGBCJ.js";import{r as j}from"./StarIcon-Dd703ZQo.js";import{r as A}from"./PhotoIcon-BirSBV19.js";import{r as L}from"./BuildingOfficeIcon-Dv5srJWW.js";const P={class:"card p-6 mb-6"},z={class:"flex items-center space-x-2"},K=["onClick"],G={key:0,class:"ml-2 text-sm text-gray-600"},H={key:0,class:"mt-1 text-sm text-red-600"},O={key:0,class:"mt-1 text-sm text-red-600"},J={class:"flex items-center space-x-4"},Q={class:"flex items-center justify-center px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-primary transition-colors"},W={class:"text-center"},X={key:0,class:"flex space-x-2"},Y=["src","alt"],Z=["onClick"],ee={key:0,class:"mt-1 text-sm text-red-600"},te={class:"flex justify-end space-x-3"},se=["disabled"],re={key:0},ae={key:1},Ve={__name:"ReviewForm",props:{bookingId:{type:Number,required:!0},houseId:{type:Number,required:!0}},emits:["review-created"],setup(n,{emit:w}){const v=x(null),y=n,k=w,{showToast:o}=U(),t=N({rating:0,comment:"",images:[]}),i=x([]),g=x(!1),l=x({}),D=d=>{const s=Array.from(d.target.files);if(s.length+i.value.length>5){o("Tối đa 5 ảnh","error");return}s.forEach(c=>{if(c.size>2*1024*1024){o("Ảnh không được vượt quá 2MB","error");return}const h=new FileReader;h.onload=C=>{i.value.push({file:c,url:C.target.result})},h.readAsDataURL(c)})},V=d=>{i.value.splice(d,1)},$=()=>{t.rating=0,t.comment="",t.images=[],i.value=[],l.value={},v.value&&(v.value.value="")},F=()=>{if(!t.rating){l.value.rating="Vui lòng chọn số sao đánh giá";return}g.value=!0,l.value={};const d=new FormData;d.append("booking_id",y.bookingId),d.append("rating",t.rating),d.append("comment",t.comment||""),i.value.forEach(s=>{d.append("images[]",s.file)}),E.post("/reviews",d,{preserveScroll:!0,onSuccess:()=>{o("Đánh giá đã được gửi thành công!","success"),$(),k("review-created")},onError:s=>{l.value=s,s.error&&o(s.error,"error")},onFinish:()=>{g.value=!1}})};return(d,s)=>(a(),r("div",P,[s[5]||(s[5]=e("h3",{class:"text-xl font-bold text-secondary mb-4"},"Viết đánh giá",-1)),e("form",{onSubmit:B(F,["prevent"]),class:"space-y-4"},[e("div",null,[s[1]||(s[1]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[q(" Đánh giá sao "),e("span",{class:"text-red-500"},"*")],-1)),e("div",z,[(a(),r(b,null,_(5,c=>e("button",{key:c,type:"button",onClick:h=>t.rating=c,class:"focus:outline-none"},[p(f(j),{class:I(["w-8 h-8 transition-colors",c<=t.rating?"text-yellow-400 fill-current":"text-gray-300"])},null,8,["class"])],8,K)),64)),t.rating?(a(),r("span",G,u(t.rating)+" / 5 sao ",1)):m("",!0)]),l.value.rating?(a(),r("p",H,u(l.value.rating),1)):m("",!0)]),e("div",null,[s[2]||(s[2]=e("label",{for:"comment",class:"block text-sm font-medium text-gray-700 mb-2"}," Bình luận ",-1)),R(e("textarea",{id:"comment","onUpdate:modelValue":s[0]||(s[0]=c=>t.comment=c),rows:"4",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Chia sẻ trải nghiệm của bạn..."},null,512),[[T,t.comment]]),l.value.comment?(a(),r("p",O,u(l.value.comment),1)):m("",!0)]),e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ảnh đánh giá (tối đa 5 ảnh) ",-1)),e("div",J,[e("label",Q,[e("input",{ref_key:"fileInput",ref:v,type:"file",multiple:"",accept:"image/*",onChange:D,class:"hidden"},null,544),e("div",W,[p(f(A),{class:"w-8 h-8 text-gray-400 mx-auto mb-1"}),s[3]||(s[3]=e("span",{class:"text-sm text-gray-600"},"Thêm ảnh",-1))])]),i.value.length>0?(a(),r("div",X,[(a(!0),r(b,null,_(i.value,(c,h)=>(a(),r("div",{key:h,class:"relative w-20 h-20 rounded-lg overflow-hidden border border-gray-300"},[e("img",{src:c.url,alt:`Preview ${h+1}`,class:"w-full h-full object-cover"},null,8,Y),e("button",{type:"button",onClick:C=>V(h),class:"absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600"},[p(f(S),{class:"w-4 h-4"})],8,Z)]))),128))])):m("",!0)]),l.value.images?(a(),r("p",ee,u(l.value.images),1)):m("",!0)]),e("div",te,[e("button",{type:"button",onClick:$,class:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50"}," Hủy "),e("button",{type:"submit",disabled:g.value||!t.rating,class:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed"},[g.value?(a(),r("span",re,"Đang gửi...")):(a(),r("span",ae,"Gửi đánh giá"))],8,se)])],32)]))}},ne={class:"card p-6"},oe={class:"flex items-start justify-between mb-4"},ie={class:"flex items-center space-x-3"},le={class:"w-12 h-12 rounded-full bg-primary-100 flex items-center justify-center"},ce={class:"text-primary font-semibold text-lg"},de={class:"font-semibold text-gray-800"},ue={class:"text-sm text-gray-500"},me={class:"flex items-center space-x-1"},ge={key:0,class:"text-gray-700 mb-4 whitespace-pre-wrap"},he={key:1,class:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4"},ve=["onClick"],pe=["src","alt"],fe={key:2,class:"mt-4 pt-4 border-t border-gray-200 bg-gray-50 rounded-lg p-4"},ye={class:"flex items-start space-x-2"},xe={class:"w-8 h-8 rounded-full bg-secondary-100 flex items-center justify-center flex-shrink-0"},be={class:"flex-1"},_e={class:"flex items-center space-x-2 mb-1"},we={key:0,class:"text-xs text-gray-500"},ke={class:"text-gray-700 whitespace-pre-wrap"},Fe={__name:"ReviewItem",props:{review:{type:Object,required:!0}},setup(n){const w=n,v=M(()=>{const o=w.review.user?.name||"K",t=o.split(" ");return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():o[0].toUpperCase()}),y=o=>o?new Date(o).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"}):"",k=o=>{window.open(o,"_blank")};return(o,t)=>(a(),r("div",ne,[e("div",oe,[e("div",ie,[e("div",le,[e("span",ce,u(v.value),1)]),e("div",null,[e("p",de,u(n.review.user?.name||"Khách hàng"),1),e("p",ue,u(y(n.review.created_at)),1)])]),e("div",me,[(a(),r(b,null,_(5,i=>p(f(j),{key:i,class:I(["w-5 h-5",i<=n.review.rating?"text-yellow-400 fill-current":"text-gray-300"])},null,8,["class"])),64))])]),n.review.comment?(a(),r("p",ge,u(n.review.comment),1)):m("",!0),n.review.images&&n.review.images.length>0?(a(),r("div",he,[(a(!0),r(b,null,_(n.review.images,(i,g)=>(a(),r("div",{key:g,class:"relative aspect-square rounded-lg overflow-hidden border border-gray-200 cursor-pointer hover:opacity-90 transition-opacity",onClick:l=>k(i)},[e("img",{src:i,alt:`Review image ${g+1}`,class:"w-full h-full object-cover"},null,8,pe)],8,ve))),128))])):m("",!0),n.review.manager_response?(a(),r("div",fe,[e("div",ye,[e("div",xe,[p(f(L),{class:"w-5 h-5 text-secondary"})]),e("div",be,[e("div",_e,[t[0]||(t[0]=e("span",{class:"font-semibold text-secondary"},"Phản hồi từ quản lý",-1)),n.review.manager_response_at?(a(),r("span",we,u(y(n.review.manager_response_at)),1)):m("",!0)]),e("p",ke,u(n.review.manager_response),1)])])])):m("",!0)]))}};export{Ve as _,Fe as a};
