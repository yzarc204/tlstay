import{u as R,r as d,c as o,a as u,b as p,h as Y,w as Q,d as e,e as c,f as v,g as w,v as U,o as r,F as _,i as X,t as n,j as E,n as Z,k as F,l as A,m as ee}from"./app-CToM1BLh.js";import{_ as te}from"./AdminLayout-4xbJWJFM.js";import{_ as se}from"./Button-ClV5b-fD.js";import{r as B}from"./PlusIcon-BfPOh7Cr.js";import{r as le}from"./ChevronRightIcon-AxYvFnIT.js";import{r as q}from"./PencilIcon-BvG312EX.js";import{r as H}from"./TrashIcon-LP00t4pg.js";import{r as oe}from"./MapPinIcon-BdmmkFCn.js";/* empty css            */import"./FlashToaster-BAEPXES7.js";import"./CalendarIcon-1FcouZeP.js";import"./PhotoIcon-x2o2DaCh.js";import"./BuildingOfficeIcon-BSfrahlc.js";const re={class:"space-y-6"},ae={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"},ne={class:"bg-white rounded-lg shadow-sm p-4"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de={key:0},ue=["value"],ce={class:"bg-white rounded-lg shadow-sm overflow-hidden"},me={class:"divide-y divide-gray-200"},pe={class:"px-6 py-4 flex items-center justify-between"},ve={class:"flex items-center flex-1 min-w-0"},ge=["onClick"],ye={class:"flex items-center flex-1 min-w-0"},xe={class:"flex-1 min-w-0"},fe={class:"text-sm font-medium text-gray-900"},he={class:"text-xs text-gray-500 mt-0.5"},be={class:"flex items-center gap-2 ml-4"},we={class:"relative group"},_e=["onClick"],ke={class:"relative group"},Ce=["onClick"],$e={class:"relative group"},je=["onClick"],Te={key:0,class:"bg-gray-50 border-t border-gray-200"},Se={class:"flex items-center flex-1 min-w-0"},Me={class:"text-sm font-medium text-gray-900"},Ve={class:"flex items-center gap-2 ml-4"},Xe=["onClick"],Ee=["onClick"],Fe={key:0,class:"px-6 py-4 pl-16 text-sm text-gray-500 italic"},Ae={key:0,class:"text-center py-12"},De={class:"flex items-center justify-center min-h-screen px-4"},Pe={class:"relative bg-white rounded-lg shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto"},ze={class:"text-lg font-semibold text-gray-900 mb-4"},Ne={class:"space-y-4"},Qe=["disabled"],Ue={key:0,class:"mt-1 text-sm text-red-600"},Be={key:0},qe=["value"],He={key:0,class:"mt-1 text-sm text-red-600"},Ke={key:0,class:"mt-1 text-sm text-red-600"},Le={class:"flex justify-end gap-3 mt-6"},We=["disabled"],Ie={class:"flex items-center justify-center min-h-screen px-4"},Oe={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full p-6"},Ge={class:"text-sm text-gray-600 mb-6"},Je={key:0,class:"block mt-2 text-red-600"},Re={class:"flex justify-end gap-3"},Ye=["disabled"],mt={__name:"Index",props:{wards:Array,parentAddresses:Array,filters:Object},setup(h){const f=h;R();const k=d(f.filters.search||""),C=d(f.filters.parent_id||""),$=d(!1),m=d(null),g=d(null),j=d(!1),T=d(!1),b=d([]),x=d({}),a=d({type:"",name:"",parent_id:""}),i=d({});let D=null;f.wards&&f.wards.forEach(l=>{x.value[l.id]=!0});const K=l=>{x.value[l]=!x.value[l]},L=()=>{clearTimeout(D),D=setTimeout(()=>{P()},300)},P=()=>{const l={};k.value&&(l.search=k.value),C.value&&(l.parent_id=C.value),A.get("/admin/addresses",l,{preserveState:!0,replace:!0,onSuccess:()=>{f.wards&&f.wards.forEach(t=>{x.value[t.id]=!0})}})},W=async()=>{a.value.parent_id="",a.value.type==="street"&&await S()},S=async()=>{if(a.value.type!=="street"){b.value=[];return}try{const l=await ee.get("/admin/addresses/by-parent",{params:{type:"ward",parent_id:null}});b.value=l.data}catch(l){console.error("Error loading parent addresses:",l),b.value=[]}},I=async l=>{$.value=!0,m.value=null,a.value={type:"street",name:"",parent_id:l.id},i.value={},await S(),x.value[l.id]=!0},z=async l=>{m.value=l,a.value={type:l.type,name:l.name,parent_id:l.parent_id||""},i.value={},a.value.type==="street"&&await S()},N=l=>{g.value=l},M=()=>{$.value=!1,m.value=null,a.value={type:"",name:"",parent_id:""},i.value={},b.value=[]},V=()=>{g.value=null},O=()=>{j.value=!0,i.value={};const l=m.value?`/admin/addresses/${m.value.id}`:"/admin/addresses",t=m.value?"put":"post";A[t](l,a.value,{preserveScroll:!0,onSuccess:()=>{M()},onError:s=>{i.value=s},onFinish:()=>{j.value=!1}})},G=()=>{g.value&&(T.value=!0,A.delete(`/admin/addresses/${g.value.id}`,{preserveScroll:!0,onFinish:()=>{T.value=!1,V()}}))};return(l,t)=>(r(),o(_,null,[u(p(Y),{title:"Quản lý Địa điểm"}),u(te,{title:"Quản lý Địa điểm"},{default:Q(()=>[e("div",re,[e("div",ae,[t[7]||(t[7]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Quản lý Địa điểm"),e("p",{class:"text-gray-600 mt-1"},"Quản lý danh sách phường/xã và đường")],-1)),u(se,{onClick:t[0]||(t[0]=s=>$.value=!0)},{default:Q(()=>[u(p(B),{class:"h-5 w-5 mr-2"}),t[6]||(t[6]=v(" Thêm địa điểm ",-1))]),_:1})]),e("div",ne,[e("div",ie,[e("div",null,[w(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),type:"text",placeholder:"Tìm kiếm theo tên địa điểm...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",onInput:L},null,544),[[U,k.value]])]),h.parentAddresses.length>0?(r(),o("div",de,[w(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",onChange:P},[t[8]||(t[8]=e("option",{value:""},"Tất cả phường/xã",-1)),(r(!0),o(_,null,X(h.parentAddresses,s=>(r(),o("option",{key:s.id,value:s.id},n(s.name),9,ue))),128))],544),[[E,C.value]])])):c("",!0)])]),e("div",ce,[e("div",me,[(r(!0),o(_,null,X(h.wards,s=>(r(),o("div",{key:s.id,class:"transition-colors hover:bg-gray-50"},[e("div",pe,[e("div",ve,[e("button",{onClick:y=>K(s.id),class:"mr-3 flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors"},[u(p(le),{class:Z(["h-5 w-5 transition-transform duration-200",x.value[s.id]?"transform rotate-90":""])},null,8,["class"])],8,ge),e("div",ye,[t[9]||(t[9]=e("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 mr-3"}," Phường/Xã ",-1)),e("div",xe,[e("div",fe,n(s.name),1),e("div",he,n(s.children_count||0)+" đường ",1)])]),t[13]||(t[13]=e("div",{class:"flex items-center gap-4 ml-4"},null,-1)),e("div",be,[e("div",we,[e("button",{onClick:y=>I(s),class:"inline-flex items-center justify-center w-8 h-8 rounded-lg text-gray-600 hover:bg-primary/10 hover:text-primary transition-colors",title:"Thêm đường"},[u(p(B),{class:"h-5 w-5"})],8,_e),t[10]||(t[10]=e("div",{class:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs font-medium text-white bg-gray-900 rounded shadow-lg whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none z-50"},[v(" Thêm đường "),e("div",{class:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"})],-1))]),e("div",ke,[e("button",{onClick:y=>z(s),class:"inline-flex items-center justify-center w-8 h-8 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-primary transition-colors",title:"Chỉnh sửa"},[u(p(q),{class:"h-5 w-5"})],8,Ce),t[11]||(t[11]=e("div",{class:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs font-medium text-white bg-gray-900 rounded shadow-lg whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none z-50"},[v(" Chỉnh sửa "),e("div",{class:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"})],-1))]),e("div",$e,[e("button",{onClick:y=>N(s),class:"inline-flex items-center justify-center w-8 h-8 rounded-lg text-gray-600 hover:bg-red-50 hover:text-red-600 transition-colors",title:"Xóa"},[u(p(H),{class:"h-5 w-5"})],8,je),t[12]||(t[12]=e("div",{class:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs font-medium text-white bg-gray-900 rounded shadow-lg whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none z-50"},[v(" Xóa "),e("div",{class:"absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"})],-1))])])])]),x.value[s.id]&&s.children&&s.children.length>0?(r(),o("div",Te,[(r(!0),o(_,null,X(s.children,y=>(r(),o("div",{key:y.id,class:"px-6 py-3 pl-16 flex items-center justify-between hover:bg-gray-100 transition-colors"},[e("div",Se,[t[14]||(t[14]=e("span",{class:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800 mr-3"}," Đường ",-1)),e("div",Me,n(y.name),1)]),t[15]||(t[15]=e("div",{class:"flex items-center gap-4 ml-4"},null,-1)),e("div",Ve,[e("button",{onClick:J=>z(y),class:"inline-flex items-center justify-center w-8 h-8 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-primary transition-colors",title:"Chỉnh sửa"},[u(p(q),{class:"h-5 w-5"})],8,Xe),e("button",{onClick:J=>N(y),class:"inline-flex items-center justify-center w-8 h-8 rounded-lg text-gray-600 hover:bg-red-50 hover:text-red-600 transition-colors",title:"Xóa"},[u(p(H),{class:"h-5 w-5"})],8,Ee)])]))),128)),s.children&&s.children.length===0?(r(),o("div",Fe," Chưa có đường nào ")):c("",!0)])):c("",!0)]))),128))]),h.wards.length===0?(r(),o("div",Ae,[u(p(oe),{class:"mx-auto h-12 w-12 text-gray-400"}),t[16]||(t[16]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"Không có địa điểm",-1)),t[17]||(t[17]=e("p",{class:"mt-1 text-sm text-gray-500"},"Không tìm thấy địa điểm nào phù hợp với bộ lọc.",-1))])):c("",!0)]),$.value||m.value?(r(),o("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:F(M,["self"])},[e("div",De,[e("div",{class:"fixed inset-0 bg-black opacity-50",onClick:M}),e("div",Pe,[e("h3",ze,n(m.value?"Chỉnh sửa địa điểm":"Thêm địa điểm mới"),1),e("form",{onSubmit:F(O,["prevent"])},[e("div",Ne,[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" Loại địa điểm "),e("span",{class:"text-red-500"},"*")],-1)),w(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.type=s),disabled:!!m.value,class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",required:"",onChange:W},[...t[18]||(t[18]=[e("option",{value:""},"Chọn loại địa điểm",-1),e("option",{value:"ward"},"Phường/Xã",-1),e("option",{value:"street"},"Đường",-1)])],40,Qe),[[E,a.value.type]]),i.value.type?(r(),o("p",Ue,n(i.value.type),1)):c("",!0)]),a.value.type==="street"?(r(),o("div",Be,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" Phường/Xã "),e("span",{class:"text-red-500"},"*")],-1)),w(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.parent_id=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",required:"",onChange:S},[t[20]||(t[20]=e("option",{value:""},"Chọn Phường/Xã",-1)),(r(!0),o(_,null,X(b.value,s=>(r(),o("option",{key:s.id,value:s.id},n(s.name),9,qe))),128))],544),[[E,a.value.parent_id]]),i.value.parent_id?(r(),o("p",He,n(i.value.parent_id),1)):c("",!0)])):c("",!0),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[v(" Tên địa điểm "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.name=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Nhập tên địa điểm",required:""},null,512),[[U,a.value.name]]),i.value.name?(r(),o("p",Ke,n(i.value.name),1)):c("",!0)])]),e("div",Le,[e("button",{type:"button",onClick:M,class:"px-4 py-2 border-2 border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"}," Hủy "),e("button",{type:"submit",disabled:j.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(j.value?"Đang xử lý...":m.value?"Cập nhật":"Tạo địa điểm"),9,We)])],32)])])])):c("",!0),g.value?(r(),o("div",{key:1,class:"fixed inset-0 z-50 overflow-y-auto",onClick:F(V,["self"])},[e("div",Ie,[e("div",{class:"fixed inset-0 bg-black opacity-50",onClick:V}),e("div",Oe,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Xác nhận xóa",-1)),e("p",Ge,[t[23]||(t[23]=v(' Bạn có chắc chắn muốn xóa địa điểm "',-1)),e("strong",null,n(g.value?.name),1),t[24]||(t[24]=v('"? ',-1)),g.value?.children_count>0?(r(),o("span",Je," Cảnh báo: Địa điểm này có "+n(g.value.children_count)+" địa điểm con. ",1)):c("",!0)]),e("div",Re,[e("button",{type:"button",onClick:V,class:"px-4 py-2 border-2 border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"}," Hủy "),e("button",{onClick:G,disabled:T.value,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(T.value?"Đang xóa...":"Xóa"),9,Ye)])])])])):c("",!0)])]),_:1})],64))}};export{mt as default};
