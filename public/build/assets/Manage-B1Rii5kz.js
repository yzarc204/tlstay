import{r as C,B as R,A as W,c,d as e,a as b,w as I,f as $,b as F,t as y,F as B,i as q,g as j,n as T,e as S,k as H,E as z,o as d,G as Z,y as K,T as X,H as Y,I as ee,z as te,v as U,l as P,h as re,q as se,j as ae,s as ne}from"./app-aSgyFo0X.js";import{c as oe,_ as le}from"./AdminLayout-CNDFy5fk.js";import{_ as L}from"./Button-gsvernT0.js";import{r as G}from"./PlusIcon-JNeTKS3Z.js";import{r as ie}from"./ChevronDownIcon-C-hdNJVg.js";import{r as de}from"./TrashIcon-DoFKMdug.js";import{u as Q,a as ue}from"./FlashToaster-BuA4IbkD.js";import{u as me}from"./useConfirm-BDi1NvhP.js";import{_ as J}from"./SelectSearchable-B02L2-DL.js";import{_ as E}from"./DateInput-CXBql0w6.js";import{a as ce}from"./amenityIcons-Br59RkBd.js";import{r as ge}from"./ChevronLeftIcon-Ch2xdibq.js";/* empty css            */import"./MapPinIcon-Dw12BWZl.js";import"./CalendarIcon-CTaZNyS6.js";import"./PhotoIcon-D5e3D0c4.js";import"./BuildingOfficeIcon-mpjZvsth.js";import"./ChevronUpDownIcon-Cb1Q5eBL.js";const he={class:"space-y-4"},ye={class:"flex items-center justify-between"},pe={class:"flex items-center gap-3"},ve={class:"text-sm text-gray-600"},fe={class:"space-y-4"},be=["onClick"],xe={class:"flex items-center gap-3"},_e={class:"text-lg font-semibold text-gray-900"},$e={class:"text-sm text-gray-600"},ke={class:"flex items-center gap-2"},we=["onClick"],Ve={class:"p-6"},Ce={class:"grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3"},Te=["onClick"],Se={class:"text-center"},Ae={class:"text-sm font-semibold text-gray-900 mb-1"},Ne={class:"text-xs text-gray-600"},Fe=["onClick"],je={__name:"RoomDiagram",props:{roomsByFloor:{type:Object,required:!0},house:{type:Object,required:!0}},emits:["select-room","add-room","add-floor","delete-floor"],setup(a,{expose:N,emit:n}){const w=a,k=n,g=C(null),l=C(!1),s=C(null),u=C([]);R(()=>w.house.floors,h=>{h&&u.value.length===0&&(u.value=Array.from({length:h},(v,_)=>_+1))},{immediate:!0});const m=W(()=>{const h=[];for(let v=1;v<=w.house.floors;v++)h.push(v);return h.sort((v,_)=>_-v)}),f=W(()=>{let h=0;return Object.values(w.roomsByFloor).forEach(v=>{const _=Array.isArray(v)?v:Object.values(v);h+=_.length}),h}),V=h=>{const v=String(h),_=w.roomsByFloor[v];return _?Array.isArray(_)?_:Object.values(_):[]},A=h=>{const v=u.value.indexOf(h);v>-1?u.value.splice(v,1):u.value.push(h)},M=h=>V(h).length===0&&w.house.floors>1,O=h=>{g.value=h,k("select-room",h)},o=h=>{s.value=h,k("add-room",h)},x=()=>{const h=u.value.length>0?Math.max(...u.value):1;k("add-room",h)},p=h=>h?new Intl.NumberFormat("vi-VN").format(h):"0",t=h=>({available:"Trống",active:"Đang ở"})[h]||"Trống",r=h=>{const v={available:"bg-green-100 text-green-800",active:"bg-red-100 text-red-800"};return v[h]||v.available},i=h=>h==="active"?"border-red-300 bg-red-50 hover:border-red-400":"border-gray-200 bg-gray-50 hover:border-gray-300 hover:shadow-sm";return N({newRoomFloor:s,showAddRoomModal:l}),(h,v)=>(d(),c("div",he,[e("div",ye,[e("div",pe,[b(L,{onClick:v[0]||(v[0]=_=>h.$emit("add-floor")),size:"sm",variant:"outline"},{default:I(()=>[b(F(G),{class:"h-4 w-4 mr-1"}),v[2]||(v[2]=$(" Thêm tầng ",-1))]),_:1}),b(L,{onClick:v[1]||(v[1]=_=>x()),size:"sm"},{default:I(()=>[b(F(G),{class:"h-4 w-4 mr-1"}),v[3]||(v[3]=$(" Thêm phòng ",-1))]),_:1})]),e("div",ve," Tổng: "+y(a.house.floors)+" tầng, "+y(f.value)+" phòng ",1)]),e("div",fe,[(d(!0),c(B,null,q(m.value,_=>(d(),c("div",{key:_,class:"bg-white rounded-lg border border-gray-200 overflow-hidden"},[e("div",{class:"flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors",onClick:D=>A(_)},[e("div",xe,[b(F(ie),{class:T(["h-5 w-5 text-gray-500 transition-transform",u.value.includes(_)?"rotate-0":"-rotate-90"])},null,8,["class"]),e("h3",_e," Tầng "+y(_),1),e("span",$e," ("+y(V(_).length)+" phòng) ",1)]),e("div",ke,[M(_)?(d(),c("button",{key:0,onClick:H(D=>h.$emit("delete-floor",_),["stop"]),class:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Xóa tầng"},[b(F(de),{class:"h-5 w-5"})],8,we)):S("",!0)])],8,be),j(e("div",Ve,[e("div",Ce,[(d(!0),c(B,null,q(V(_),D=>(d(),c("div",{key:D.id,onClick:hr=>O(D),class:T(["relative p-4 border-2 rounded-lg cursor-pointer transition-all",g.value?.id===D.id?"border-primary bg-primary/10 shadow-md":i(D.status)])},[e("div",Se,[e("div",Ae,y(D.room_number),1),e("div",Ne,y(p(D.price_per_day))+"đ/ngày ",1),e("div",{class:T(["mt-2 text-xs px-2 py-1 rounded-full inline-block",r(D.status)])},y(t(D.status)),3)])],10,Te))),128)),e("div",{onClick:D=>o(_),class:"p-4 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-primary hover:bg-primary/5 transition-all flex items-center justify-center"},[b(F(G),{class:"h-8 w-8 text-gray-400"})],8,Fe)])],512),[[z,u.value.includes(_)]])]))),128))])]))}},De={__name:"SidePanel",props:{isOpen:{type:Boolean,default:!1}},emits:["close"],setup(a){const N=Z();return(n,w)=>(d(),c(B,null,[(d(),K(Y,{to:"body"},[b(X,{"enter-active-class":"transition-opacity duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:I(()=>[a.isOpen?(d(),c("div",{key:0,onClick:w[0]||(w[0]=k=>n.$emit("close")),class:"fixed inset-0 z-40 bg-black/50",style:{top:"0",left:"0",right:"0",bottom:"0",width:"100%",height:"100%","min-height":"100vh"}})):S("",!0)]),_:1})])),(d(),K(Y,{to:"body"},[b(X,{"enter-active-class":"transition-transform duration-300 ease-out","enter-from-class":"translate-x-full","enter-to-class":"translate-x-0","leave-active-class":"transition-transform duration-300 ease-in","leave-from-class":"translate-x-0","leave-to-class":"translate-x-full"},{default:I(()=>[a.isOpen?(d(),c("aside",{key:0,class:T(F(oe)("fixed right-0 top-0 z-50 h-screen w-full md:w-1/2 bg-white shadow-xl overflow-y-auto",F(N).class))},[ee(n.$slots,"default")],2)):S("",!0)]),_:3})]))],64))}},Ie={class:"space-y-4"},Me=["value"],Be={key:0,class:"mt-1 text-sm text-red-600"},Oe=["value","max"],Ue={key:0,class:"mt-1 text-sm text-red-600"},Pe={class:"flex items-center gap-2"},qe=["value"],Ee={class:"text-xs text-gray-500 font-medium whitespace-nowrap"},Re={key:0,class:"mt-1 text-sm text-red-600"},He=["value"],Le={key:0,class:"mt-1 text-sm text-red-600"},ze=["value"],We={key:0,class:"mt-1 text-sm text-red-600"},Ge={class:"grid grid-cols-2 gap-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3"},Ke=["checked","onChange"],Xe={class:"text-sm text-gray-700"},Ye={class:"mt-2 text-xs text-gray-500"},Qe={key:0,class:"text-blue-600"},Je={key:1},Ze={__name:"RoomInfoTab",props:{modelValue:{type:Object,required:!0},house:{type:Object,required:!0},errors:{type:Object,default:()=>({})},hasInheritedAmenities:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(a,{emit:N}){const n=u=>u?new Intl.NumberFormat("vi-VN").format(u):"0",w=u=>!u||u===0?"":n(u)+" đ",k=a,g=N,l={Wifi:"Wifi",AirConditioning:"Điều hòa",HotWater:"Nóng lạnh",PrivateKitchen:"Bếp riêng",SharedKitchen:"Bếp chung",SharedBathroom:"Vệ sinh chung",PrivateBathroom:"Vệ sinh khép kín",Bed:"Giường",Wardrobe:"Tủ",Refrigerator:"Tủ lạnh",Balcony:"Ban công",SharedWashingMachine:"Máy giặt chung",PrivateWashingMachine:"Máy giặt riêng",SharedDryer:"Máy sấy quần áo chung",PrivateDryer:"Máy sấy quần áo riêng"},s=(u,m)=>{const f=[...k.modelValue.amenities];if(m)f.includes(u)||f.push(u);else{const V=f.indexOf(u);V>-1&&f.splice(V,1)}g("update:modelValue",{...k.modelValue,amenities:f})};return(u,m)=>(d(),c("div",Ie,[e("div",null,[m[5]||(m[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Số phòng "),e("span",{class:"text-red-500"},"*")],-1)),e("input",{value:a.modelValue.room_number,onInput:m[0]||(m[0]=f=>u.$emit("update:modelValue",{...a.modelValue,room_number:f.target.value})),type:"text",required:"",class:T(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition-colors",a.errors.room_number?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-primary"])},null,42,Me),a.errors.room_number?(d(),c("p",Be,y(a.errors.room_number),1)):S("",!0)]),e("div",null,[m[6]||(m[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Tầng "),e("span",{class:"text-red-500"},"*")],-1)),e("input",{value:a.modelValue.floor,onInput:m[1]||(m[1]=f=>u.$emit("update:modelValue",{...a.modelValue,floor:Number(f.target.value)})),type:"number",min:"1",max:a.house.floors,required:"",class:T(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition-colors",a.errors.floor?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-primary"])},null,42,Oe),a.errors.floor?(d(),c("p",Ue,y(a.errors.floor),1)):S("",!0)]),e("div",null,[m[7]||(m[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Giá thuê/ngày (VNĐ) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Pe,[e("input",{value:a.modelValue.price_per_day,onInput:m[2]||(m[2]=f=>u.$emit("update:modelValue",{...a.modelValue,price_per_day:f.target.value})),type:"number",step:"1000",min:"0",required:"",class:T(["flex-1 px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition-colors",a.errors.price_per_day?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-primary"])},null,42,qe),e("span",Ee,y(w(a.modelValue.price_per_day)),1)]),a.errors.price_per_day?(d(),c("p",Re,y(a.errors.price_per_day),1)):S("",!0)]),e("div",null,[m[8]||(m[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Diện tích (m²)",-1)),e("input",{value:a.modelValue.area,onInput:m[3]||(m[3]=f=>u.$emit("update:modelValue",{...a.modelValue,area:f.target.value})),type:"number",step:"0.01",min:"0",class:T(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition-colors",a.errors.area?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-primary"])},null,42,He),a.errors.area?(d(),c("p",Le,y(a.errors.area),1)):S("",!0)]),e("div",null,[m[10]||(m[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Trạng thái "),e("span",{class:"text-red-500"},"*")],-1)),e("select",{value:a.modelValue.status,onChange:m[4]||(m[4]=f=>u.$emit("update:modelValue",{...a.modelValue,status:f.target.value})),required:"",class:T(["w-full px-4 py-2 border rounded-lg focus:ring-2 focus:outline-none transition-colors",a.errors.status?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-primary"])},[...m[9]||(m[9]=[e("option",{value:"available"},"Trống",-1),e("option",{value:"active"},"Đang thuê",-1)])],42,ze),a.errors.status?(d(),c("p",We,y(a.errors.status),1)):S("",!0)]),e("div",null,[m[11]||(m[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Tiện nghi "),e("span",{class:"text-xs text-gray-500 font-normal ml-2"}," (Kế thừa từ nhà trọ, có thể chỉnh sửa) ")],-1)),e("div",Ge,[(d(),c(B,null,q(l,(f,V)=>e("label",{key:V,class:"flex items-center space-x-2 cursor-pointer p-2 hover:bg-gray-50 rounded"},[e("input",{checked:a.modelValue.amenities.includes(V),onChange:A=>s(V,A.target.checked),type:"checkbox",class:"rounded border-gray-300 text-primary focus:ring-primary"},null,40,Ke),e("span",Xe,y(f),1)])),64))]),e("p",Ye,[a.hasInheritedAmenities?(d(),c("span",Qe," ⓘ Đang hiển thị tiện nghi kế thừa từ nhà trọ ")):(d(),c("span",Je," ✓ Phòng có tiện nghi riêng "))])])]))}},et={class:"space-y-4"},tt={key:0,class:"space-y-2"},rt={class:"grid grid-cols-2 gap-3 max-h-96 overflow-y-auto border border-gray-200 rounded-lg p-3"},st=["onClick"],at=["src","alt"],nt={key:0,class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},ot={key:1,class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},lt={key:0,class:"text-xs text-green-600 mt-2"},it={key:1,class:"text-xs text-gray-500 mt-2"},dt={key:1,class:"text-center py-8 text-sm text-gray-500 border border-gray-200 rounded-lg"},ut={__name:"RoomImagesTab",props:{houseImages:{type:Array,default:()=>[]},selectedImages:{type:Array,default:()=>[]}},emits:["update:selectedImages"],setup(a,{emit:N}){const n=a,w=N,k=l=>n.selectedImages.includes(l),g=l=>{const s=[...n.selectedImages],u=s.indexOf(l);u>-1?s.splice(u,1):s.push(l),w("update:selectedImages",s)};return(l,s)=>(d(),c("div",et,[e("div",null,[s[4]||(s[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Hình ảnh phòng "),e("span",{class:"text-xs text-gray-500 font-normal ml-2"}," (Chọn từ ảnh đã upload của nhà trọ) ")],-1)),a.houseImages.length>0?(d(),c("div",tt,[s[2]||(s[2]=e("p",{class:"text-xs text-gray-500 mb-2"}," Nhấp vào ảnh để chọn hiển thị cho phòng này ",-1)),e("div",rt,[(d(!0),c(B,null,q(a.houseImages,(u,m)=>(d(),c("div",{key:m,class:"relative group cursor-pointer",onClick:f=>g(u)},[e("div",{class:T(["relative overflow-hidden rounded-lg border-2 transition-all",k(u)?"border-primary ring-2 ring-primary ring-offset-2":"border-gray-200 hover:border-gray-300"])},[e("img",{src:u,alt:`House image ${m+1}`,class:"w-full h-32 object-cover"},null,8,at),e("div",{class:T(["absolute top-1 right-1 rounded-full p-1 shadow-lg transition-all duration-200",k(u)?"bg-primary text-white ring-2 ring-primary ring-offset-2":"bg-white text-gray-400 hover:bg-gray-50"])},[k(u)?(d(),c("svg",nt,[...s[0]||(s[0]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)])])):(d(),c("svg",ot,[...s[1]||(s[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])]))],2)],2)],8,st))),128))]),a.selectedImages.length>0?(d(),c("p",lt," Đã chọn "+y(a.selectedImages.length)+" ảnh cho phòng này ",1)):(d(),c("p",it," Chưa chọn ảnh nào. Nhấp vào ảnh để chọn. "))])):(d(),c("div",dt,[...s[3]||(s[3]=[e("p",{class:"mb-2"},"Nhà trọ chưa có ảnh.",-1),e("p",{class:"text-xs"},"Vui lòng thêm ảnh cho nhà trọ trước khi chọn ảnh cho phòng.",-1)])]))])]))}},mt={class:"space-y-4"},ct={key:0,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},gt={key:1,class:"space-y-4"},ht={class:"pt-4 border-t"},yt={class:"flex items-center justify-between mb-4"},pt={key:0,class:"space-y-3"},vt={key:0,class:"text-center py-8 text-sm text-gray-500 border border-gray-200 rounded-lg"},ft={class:"flex items-start justify-between mb-2"},bt={class:"font-medium text-gray-900"},xt={class:"text-xs text-gray-500 mt-1"},_t={class:"space-y-1 text-sm mt-3"},$t={class:"flex justify-between"},kt={class:"font-medium"},wt={class:"flex justify-between"},Vt={class:"font-medium"},Ct={key:0,class:"flex justify-between"},Tt={class:"font-medium"},St={class:"flex justify-between pt-2 border-t"},At={class:"font-bold text-primary"},Nt={key:0,class:"mt-2 text-xs text-gray-500"},Ft={class:"grid grid-cols-2 gap-4"},jt={class:"flex items-center gap-2"},Dt={class:"text-xs text-gray-500 font-medium whitespace-nowrap"},It={key:0,class:"mt-1 text-sm text-red-600"},Mt={class:"flex items-center gap-2"},Bt={class:"text-xs text-gray-500 font-medium whitespace-nowrap"},Ot={key:0,class:"mt-1 text-sm text-red-600"},Ut={class:"flex items-center gap-2"},Pt={class:"text-xs text-gray-500 font-medium whitespace-nowrap"},qt={key:0},Et={key:1},Rt={__name:"TenantInfoTab",props:{form:{type:Object,required:!0},users:{type:Array,default:()=>[]},errors:{type:Object,default:()=>({})},room:{type:Object,default:null},house:{type:Object,required:!0},isActive:{type:Boolean,default:!1}},emits:["update:form"],setup(a,{emit:N}){const n=a,w=N,k=Q(),g=C({start_date:"",end_date:"",electricity_amount:0,water_amount:0,other_fees:0,due_date:"",notes:""}),l=C({}),s=C(!1),u=C(!1),m=C([]);R([()=>n.room,()=>n.form.tenant_id],async([t,r])=>{t?.id&&r?await f():m.value=[]},{immediate:!0}),R(()=>n.isActive,async t=>{t&&n.room?.id&&n.form.tenant_id&&await f()}),te(async()=>{n.isActive&&n.room?.id&&n.form.tenant_id&&await f()});const f=async()=>{if(!n.room?.id||!n.form.tenant_id){m.value=[];return}try{const t=await fetch(`/admin/houses/${n.house.id}/rooms/${n.room.id}/invoices`);if(t.ok){const r=await t.json();m.value=r.invoices||[]}}catch(t){console.error("Error loading invoices:",t),m.value=[]}},V=t=>t?new Intl.NumberFormat("vi-VN").format(t):"0",A=t=>!t||t===0?"":V(t)+" đ",M=t=>t?new Date(t).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A",O=(t,r)=>!t||!r?"N/A":`${M(t)} - ${M(r)}`,o=t=>t?new Date(t).toLocaleString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",x=t=>{const r=n.users.find(i=>i.id===t);w("update:form",{...n.form,tenant_id:t,tenant_name:r?r.name:""})},p=()=>{if(n.room?.id){if(l.value={},!g.value.start_date){l.value.start_date="Vui lòng chọn ngày bắt đầu";return}if(!g.value.end_date){l.value.end_date="Vui lòng chọn ngày kết thúc";return}if(g.value.electricity_amount===null||g.value.electricity_amount<0){l.value.electricity_amount="Vui lòng nhập tiền điện";return}if(g.value.water_amount===null||g.value.water_amount<0){l.value.water_amount="Vui lòng nhập tiền nước";return}s.value=!0,P.post(`/admin/houses/${n.house.id}/rooms/${n.room.id}/invoices`,g.value,{preserveScroll:!0,onSuccess:()=>{k.success("Tạo hóa đơn điện nước thành công"),g.value={start_date:"",end_date:"",electricity_amount:0,water_amount:0,other_fees:0,due_date:"",notes:""},l.value={},s.value=!1,u.value=!1,f()},onError:t=>{k.error("Có lỗi xảy ra khi tạo hóa đơn"),l.value=t,s.value=!1}})}};return(t,r)=>(d(),c("div",mt,[a.form.status!=="active"?(d(),c("div",ct,[...r[10]||(r[10]=[e("p",{class:"text-sm text-yellow-800"},[e("span",{class:"font-medium"},"Lưu ý:"),$(' Phòng đang ở trạng thái "Trống". Để thêm khách thuê, vui lòng chuyển trạng thái phòng sang "Đang thuê" trong tab "Thông tin phòng trọ". ')],-1)])])):(d(),c("div",gt,[e("div",null,[r[11]||(r[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Người đang thuê "),e("span",{class:"text-red-500"},"*")],-1)),b(J,{"model-value":a.form.tenant_id,"onUpdate:modelValue":x,options:a.users,"option-value":"id","option-label":i=>`${i.name} (${i.email}${i.phone?" - "+i.phone:""})`,placeholder:"Tìm kiếm và chọn người thuê...",error:a.errors.tenant_id,hint:"Chọn tài khoản người dùng đang thuê phòng này"},null,8,["model-value","options","option-label","error"])]),e("div",null,[r[12]||(r[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Ngày bắt đầu thuê "),e("span",{class:"text-red-500"},"*")],-1)),b(E,{"model-value":a.form.rental_start_date,"onUpdate:modelValue":r[0]||(r[0]=i=>t.$emit("update:form",{...a.form,rental_start_date:i})),error:a.errors.rental_start_date,placeholder:"dd/mm/yyyy"},null,8,["model-value","error"])]),e("div",null,[r[13]||(r[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Ngày kết thúc thuê "),e("span",{class:"text-red-500"},"*")],-1)),b(E,{"model-value":a.form.rental_end_date,"onUpdate:modelValue":r[1]||(r[1]=i=>t.$emit("update:form",{...a.form,rental_end_date:i})),error:a.errors.rental_end_date,min:a.form.rental_start_date||void 0,placeholder:"dd/mm/yyyy"},null,8,["model-value","error","min"])]),e("div",ht,[e("div",yt,[r[14]||(r[14]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Hóa đơn điện nước",-1)),e("button",{type:"button",onClick:r[2]||(r[2]=i=>u.value=!u.value),class:"text-sm text-primary hover:text-primary-600 font-medium"},y(u.value?"Xem danh sách":"Tạo hóa đơn mới"),1)]),u.value?(d(),c("form",{key:1,onSubmit:H(p,["prevent"]),class:"space-y-4"},[e("div",Ft,[e("div",null,[r[20]||(r[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Từ ngày "),e("span",{class:"text-red-500"},"*")],-1)),b(E,{modelValue:g.value.start_date,"onUpdate:modelValue":r[3]||(r[3]=i=>g.value.start_date=i),error:l.value.start_date,placeholder:"dd/mm/yyyy"},null,8,["modelValue","error"])]),e("div",null,[r[21]||(r[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Đến ngày "),e("span",{class:"text-red-500"},"*")],-1)),b(E,{modelValue:g.value.end_date,"onUpdate:modelValue":r[4]||(r[4]=i=>g.value.end_date=i),error:l.value.end_date,min:g.value.start_date||void 0,placeholder:"dd/mm/yyyy"},null,8,["modelValue","error","min"])])]),e("div",null,[r[22]||(r[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Tiền điện (VNĐ) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",jt,[j(e("input",{"onUpdate:modelValue":r[5]||(r[5]=i=>g.value.electricity_amount=i),type:"number",min:"0",step:"1000",placeholder:"0",class:T(["flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",{"border-red-500":l.value.electricity_amount}])},null,2),[[U,g.value.electricity_amount,void 0,{number:!0}]]),e("span",Dt,y(A(g.value.electricity_amount)),1)]),l.value.electricity_amount?(d(),c("p",It,y(l.value.electricity_amount),1)):S("",!0)]),e("div",null,[r[23]||(r[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Tiền nước (VNĐ) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Mt,[j(e("input",{"onUpdate:modelValue":r[6]||(r[6]=i=>g.value.water_amount=i),type:"number",min:"0",step:"1000",placeholder:"0",class:T(["flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",{"border-red-500":l.value.water_amount}])},null,2),[[U,g.value.water_amount,void 0,{number:!0}]]),e("span",Bt,y(A(g.value.water_amount)),1)]),l.value.water_amount?(d(),c("p",Ot,y(l.value.water_amount),1)):S("",!0)]),e("div",null,[r[24]||(r[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Phí khác (VNĐ) ",-1)),e("div",Ut,[j(e("input",{"onUpdate:modelValue":r[7]||(r[7]=i=>g.value.other_fees=i),type:"number",min:"0",step:"1000",placeholder:"0",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[U,g.value.other_fees,void 0,{number:!0}]]),e("span",Pt,y(A(g.value.other_fees)),1)])]),e("div",null,[r[25]||(r[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ngày đến hạn ",-1)),b(E,{modelValue:g.value.due_date,"onUpdate:modelValue":r[8]||(r[8]=i=>g.value.due_date=i),error:l.value.due_date,placeholder:"dd/mm/yyyy"},null,8,["modelValue","error"])]),e("div",null,[r[26]||(r[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ghi chú ",-1)),j(e("textarea",{"onUpdate:modelValue":r[9]||(r[9]=i=>g.value.notes=i),rows:"3",placeholder:"Nhập ghi chú (nếu có)...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"},null,512),[[U,g.value.notes]])]),b(L,{type:"submit",disabled:s.value,class:"w-full"},{default:I(()=>[s.value?(d(),c("span",qt,"Đang tạo...")):(d(),c("span",Et,"Tạo hóa đơn"))]),_:1},8,["disabled"])],32)):(d(),c("div",pt,[m.value.length===0?(d(),c("div",vt,[...r[15]||(r[15]=[e("p",null,"Chưa có hóa đơn nào",-1)])])):S("",!0),(d(!0),c(B,null,q(m.value,i=>(d(),c("div",{key:i.id,class:"border border-gray-200 rounded-lg p-4 hover:border-gray-300 transition-colors"},[e("div",ft,[e("div",null,[e("p",bt,y(O(i.start_date,i.end_date)),1),e("p",xt," Ngày đến hạn: "+y(i.due_date?M(i.due_date):"N/A"),1)]),e("span",{class:T(["px-2 py-1 rounded-full text-xs font-medium",i.status==="paid"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},y(i.status==="paid"?"Đã thanh toán":"Chưa thanh toán"),3)]),e("div",_t,[e("div",$t,[r[16]||(r[16]=e("span",{class:"text-gray-600"},"Tiền điện:",-1)),e("span",kt,y(V(i.electricity_amount))+" VNĐ",1)]),e("div",wt,[r[17]||(r[17]=e("span",{class:"text-gray-600"},"Tiền nước:",-1)),e("span",Vt,y(V(i.water_amount))+" VNĐ",1)]),i.other_fees>0?(d(),c("div",Ct,[r[18]||(r[18]=e("span",{class:"text-gray-600"},"Phí khác:",-1)),e("span",Tt,y(V(i.other_fees))+" VNĐ",1)])):S("",!0),e("div",St,[r[19]||(r[19]=e("span",{class:"font-semibold text-gray-900"},"Tổng cộng:",-1)),e("span",At,y(V(i.total))+" VNĐ",1)])]),i.paid_at?(d(),c("div",Nt," Đã thanh toán: "+y(o(i.paid_at)),1)):S("",!0)]))),128))]))])]))]))}},Ht={class:"flex flex-col h-full"},Lt={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-white px-6 py-4"},zt={class:"text-lg font-semibold text-gray-900"},Wt={class:"flex-1 overflow-y-auto p-6"},Gt={class:"border-b border-gray-200 mb-6"},Kt={class:"-mb-px flex space-x-8","aria-label":"Tabs"},Xt={class:"flex gap-3 pt-4 border-t"},Yt={__name:"RoomForm",props:{room:Object,house:Object,users:{type:Array,default:()=>[]},errors:{type:Object,default:()=>({})}},emits:["close"],setup(a,{emit:N}){const n=a,w=N,k=Q(),g=me(),l=C("room"),s=C({room_number:"",floor:1,price_per_day:"",status:"available",area:"",amenities:[],images:[],tenant_name:"",tenant_id:null,rental_start_date:"",rental_end_date:""}),u=C(!1),m=C([]),f=W(()=>n.house?.images?Array.isArray(n.house.images)?n.house.images.filter(o=>o&&o.trim()!==""):[]:[]),V=W(()=>{if(!n.room)return!1;const o=n.room.amenities;return!o||!Array.isArray(o)||o.length===0});R(()=>n.room,o=>{if(o){l.value="room";const x=o.amenities&&Array.isArray(o.amenities)&&o.amenities.length>0?o.amenities:n.house?.amenities||[],p=o.images&&Array.isArray(o.images)&&o.images.length>0?o.images.filter(r=>r&&r.trim()!==""):[];m.value=[...p];const t=r=>{if(!r)return"";const i=new Date(r),h=i.getFullYear(),v=String(i.getMonth()+1).padStart(2,"0"),_=String(i.getDate()).padStart(2,"0");return`${h}-${v}-${_}`};s.value={room_number:o.room_number||"",floor:o.floor||1,price_per_day:o.price_per_day||"",status:o.status||"available",area:o.area||"",amenities:x,images:p,tenant_name:o.tenant_name||"",tenant_id:o.tenant_id||null,rental_start_date:t(o.rental_start_date),rental_end_date:t(o.rental_end_date)}}else m.value=[]},{immediate:!0});const A=o=>{m.value=o,s.value.images=[...o]};R(()=>s.value.status,o=>{o!=="active"?(s.value.tenant_id=null,s.value.tenant_name="",s.value.rental_start_date="",s.value.rental_end_date="",l.value==="tenant"&&(l.value="room")):l.value="tenant"});const M=async()=>{if(l.value==="tenant")try{await g.show({title:"Cập nhật thông tin khách thuê",message:"Bạn có chắc chắn muốn cập nhật thông tin khách thuê? Hành động này có thể ảnh hưởng đến các hóa đơn và đặt phòng liên quan.",confirmText:"Cập nhật",cancelText:"Hủy",confirmVariant:"primary"})}catch(t){t.message!=="USER_CANCELLED"&&console.error("Error showing confirm dialog:",t);return}u.value=!0;let o={};if(l.value==="room"){if(o={room_number:s.value.room_number,floor:s.value.floor,price_per_day:s.value.price_per_day,status:s.value.status,area:s.value.area,amenities:s.value.amenities},s.value.status!=="active")o.tenant_id=null,o.tenant_name=null,o.rental_start_date=null,o.rental_end_date=null;else if(n.room?.tenant_id){if(o.tenant_id=n.room.tenant_id,o.tenant_name=n.room.tenant_name,n.room.rental_start_date){const t=new Date(n.room.rental_start_date);o.rental_start_date=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}if(n.room.rental_end_date){const t=new Date(n.room.rental_end_date);o.rental_end_date=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}}}else if(l.value==="images"){if(o={room_number:s.value.room_number,floor:s.value.floor,price_per_day:s.value.price_per_day,status:s.value.status,area:s.value.area,amenities:s.value.amenities,images:[...m.value]},s.value.status==="active"&&n.room?.tenant_id){if(o.tenant_id=n.room.tenant_id,o.tenant_name=n.room.tenant_name,n.room.rental_start_date){const t=new Date(n.room.rental_start_date);o.rental_start_date=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}if(n.room.rental_end_date){const t=new Date(n.room.rental_end_date);o.rental_end_date=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}}}else l.value==="tenant"&&(o={room_number:s.value.room_number,floor:s.value.floor,price_per_day:s.value.price_per_day,status:s.value.status,tenant_id:s.value.tenant_id,tenant_name:s.value.tenant_name,rental_start_date:s.value.rental_start_date,rental_end_date:s.value.rental_end_date});const p={room:"Cập nhật thông tin phòng thành công",images:"Cập nhật hình ảnh phòng thành công",tenant:"Cập nhật thông tin khách thuê thành công"}[l.value]||"Cập nhật thành công";P.put(`/admin/houses/${n.house.id}/rooms/${n.room.id}`,o,{preserveScroll:!0,onSuccess:()=>{k.success(p)},onError:()=>{k.error("Có lỗi xảy ra khi cập nhật")},onFinish:()=>{u.value=!1}})},O=async()=>{try{await g.show({title:"Xóa phòng",message:"Bạn có chắc chắn muốn xóa phòng này? Hành động này không thể hoàn tác.",confirmText:"Xóa",cancelText:"Hủy",confirmVariant:"danger"}),P.delete(`/admin/houses/${n.house.id}/rooms/${n.room.id}`,{preserveScroll:!0,onSuccess:()=>{w("close")}})}catch(o){o.message!=="USER_CANCELLED"&&console.error("Error showing confirm dialog:",o)}};return(o,x)=>(d(),K(De,{"is-open":!!a.room,onClose:x[6]||(x[6]=p=>o.$emit("close"))},{default:I(()=>[e("div",Ht,[e("div",Lt,[e("h3",zt,y(a.room?`Thông tin phòng ${a.room.room_number}`:"Thông tin phòng"),1),e("button",{onClick:x[0]||(x[0]=p=>o.$emit("close")),class:"text-gray-400 hover:text-gray-600 transition-colors"},[b(F(ue),{class:"h-5 w-5"})])]),e("div",Wt,[e("div",Gt,[e("nav",Kt,[e("button",{type:"button",onClick:x[1]||(x[1]=p=>l.value="room"),class:T(["py-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap",l.value==="room"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Thông tin phòng trọ ",2),e("button",{type:"button",onClick:x[2]||(x[2]=p=>l.value="images"),class:T(["py-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap",l.value==="images"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Hình ảnh ",2),e("button",{type:"button",onClick:x[3]||(x[3]=p=>l.value="tenant"),class:T(["py-2 px-1 border-b-2 font-medium text-sm transition-colors whitespace-nowrap",l.value==="tenant"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Khách thuê ",2)])]),e("form",{onSubmit:H(M,["prevent"]),class:"space-y-4"},[j(b(Ze,{modelValue:s.value,"onUpdate:modelValue":x[4]||(x[4]=p=>s.value=p),house:a.house,errors:a.errors,"has-inherited-amenities":V.value},null,8,["modelValue","house","errors","has-inherited-amenities"]),[[z,l.value==="room"]]),j(b(ut,{"house-images":f.value,"selected-images":m.value,"onUpdate:selectedImages":A},null,8,["house-images","selected-images"]),[[z,l.value==="images"]]),j(b(Rt,{form:s.value,users:a.users,errors:a.errors,room:a.room,house:a.house,"is-active":l.value==="tenant","onUpdate:form":x[5]||(x[5]=p=>s.value=p)},null,8,["form","users","errors","room","house","is-active"]),[[z,l.value==="tenant"]]),e("div",Xt,[b(L,{type:"button",variant:"outline",onClick:O,class:"flex-1"},{default:I(()=>[...x[7]||(x[7]=[$(" Xóa phòng ",-1)])]),_:1}),b(L,{type:"submit",disabled:u.value,class:"flex-1"},{default:I(()=>[$(y(u.value?"Đang lưu...":"Lưu thay đổi"),1)]),_:1},8,["disabled"])])],32)])])]),_:1},8,["is-open"]))}},Qt={class:"space-y-6"},Jt={class:"flex items-center justify-between"},Zt={class:"text-2xl font-bold text-gray-900"},er={class:"text-gray-600 mt-1"},tr={class:"flex items-center justify-center min-h-screen px-4"},rr={class:"relative bg-white rounded-lg shadow-xl max-w-md w-full p-6"},sr={class:"text-sm text-gray-600 mb-4"},ar={class:"font-semibold text-primary"},nr={class:"space-y-4"},or={class:"flex items-center gap-2"},lr={class:"text-xs text-gray-500 font-medium whitespace-nowrap"},ir={key:0},dr={class:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3"},ur=["value"],mr={class:"text-sm text-gray-700"},cr={class:"flex justify-end gap-3 mt-6"},gr=["disabled"],Dr={__name:"Manage",props:{house:Object,roomsByFloor:Object,users:{type:Array,default:()=>[]},errors:{type:Object,default:()=>({})}},setup(a){const N=ce,n=a,w=C(null),k=C(!1),g=C(!1),l=C(null),s=C({room_number:"",floor:1,price_per_day:"",status:"available",amenities:[],tenant_id:null,tenant_name:""}),u=p=>p?new Intl.NumberFormat("vi-VN").format(p):"0",m=p=>!p||p===0?"":u(p)+" đ",f=p=>{w.value=p},V=p=>{p?s.value.floor=p:s.value.floor=1,s.value.price_per_day=n.house.price_per_day||"",s.value.amenities=n.house.amenities?[...n.house.amenities]:[],k.value=!0},A=()=>{k.value=!1,s.value={room_number:"",floor:1,price_per_day:"",status:"available",amenities:[],tenant_id:null,tenant_name:""},l.value&&(l.value.newRoomFloor=null)},M=()=>{if(s.value.tenant_id){const p=n.users.find(t=>t.id===s.value.tenant_id);p&&(s.value.tenant_name=p.name)}else s.value.tenant_name=""},O=()=>{g.value=!0,P.post(`/admin/houses/${n.house.id}/rooms`,s.value,{preserveScroll:!0,onSuccess:()=>{A()},onFinish:()=>{g.value=!1}})},o=()=>{confirm("Bạn có chắc chắn muốn thêm tầng mới?")&&P.post(`/admin/houses/${n.house.id}/floors`,{},{preserveScroll:!0})},x=p=>{confirm(`Bạn có chắc chắn muốn xóa tầng ${p}? Các phòng ở tầng trên sẽ được di chuyển xuống.`)&&P.delete(`/admin/houses/${n.house.id}/floors`,{data:{floor:p},preserveScroll:!0})};return(p,t)=>(d(),c(B,null,[b(F(re),{title:"Quản lý Phòng"}),b(le,{title:"Quản lý Phòng"},{default:I(()=>[e("div",Qt,[e("div",Jt,[e("div",null,[b(F(se),{href:"/admin/houses",class:"text-primary hover:text-primary-600 mb-2 inline-flex items-center text-sm"},{default:I(()=>[b(F(ge),{class:"h-4 w-4 mr-1"}),t[6]||(t[6]=$(" Quay lại danh sách ",-1))]),_:1}),e("h1",Zt,y(a.house.name),1),e("p",er,y(a.house.address),1)])]),e("div",null,[b(je,{ref_key:"roomDiagramRef",ref:l,"rooms-by-floor":a.roomsByFloor,house:a.house,onSelectRoom:f,onAddRoom:V,onAddFloor:o,onDeleteFloor:x},null,8,["rooms-by-floor","house"])]),b(Yt,{room:w.value,house:a.house,users:a.users,errors:a.errors,onClose:t[0]||(t[0]=r=>w.value=null)},null,8,["room","house","users","errors"]),k.value?(d(),c("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:H(A,["self"])},[e("div",tr,[e("div",{class:"fixed inset-0 bg-black opacity-50",onClick:A}),e("div",rr,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Thêm phòng mới",-1)),e("p",sr,[t[7]||(t[7]=$("Tầng: ",-1)),e("span",ar,"Tầng "+y(s.value.floor),1)]),e("form",{onSubmit:H(O,["prevent"])},[e("div",nr,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Số phòng "),e("span",{class:"text-red-500"},"*")],-1)),j(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>s.value.room_number=r),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"101"},null,512),[[U,s.value.room_number]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Giá thuê/ngày (VNĐ) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",or,[j(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.value.price_per_day=r),type:"number",step:"1000",min:"0",required:"",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"500000"},null,512),[[U,s.value.price_per_day,void 0,{number:!0}]]),e("span",lr,y(m(s.value.price_per_day)),1)])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Trạng thái "),e("span",{class:"text-red-500"},"*")],-1)),j(e("select",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.value.status=r),required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"},[...t[10]||(t[10]=[e("option",{value:"available"},"Trống",-1),e("option",{value:"active"},"Đang thuê",-1)])],512),[[ae,s.value.status]])]),s.value.status==="active"?(d(),c("div",ir,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[$(" Người đang thuê "),e("span",{class:"text-red-500"},"*")],-1)),b(J,{modelValue:s.value.tenant_id,"onUpdate:modelValue":[t[4]||(t[4]=r=>s.value.tenant_id=r),M],options:a.users,"option-value":"id","option-label":r=>`${r.name} (${r.email}${r.phone?" - "+r.phone:""})`,placeholder:"Tìm kiếm và chọn người thuê...",hint:"Chọn tài khoản người dùng đang thuê phòng này"},null,8,["modelValue","options","option-label"])])):S("",!0),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tiện nghi",-1)),e("div",dr,[(d(!0),c(B,null,q(F(N),(r,i)=>(d(),c("label",{key:i,class:"flex items-center space-x-2 cursor-pointer p-2 hover:bg-gray-50 rounded"},[j(e("input",{"onUpdate:modelValue":t[5]||(t[5]=h=>s.value.amenities=h),type:"checkbox",value:i,class:"rounded border-gray-300 text-primary focus:ring-primary"},null,8,ur),[[ne,s.value.amenities]]),e("span",mr,y(r),1)]))),128))]),t[14]||(t[14]=e("p",{class:"mt-1 text-xs text-gray-500"},"Tiện nghi đã được kế thừa từ nhà trọ, bạn có thể chỉnh sửa",-1))])]),e("div",cr,[e("button",{type:"button",onClick:A,class:"px-4 py-2 border-2 border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"}," Hủy "),e("button",{type:"submit",disabled:g.value,class:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},y(g.value?"Đang thêm...":"Thêm phòng"),9,gr)])],32)])])])):S("",!0)])]),_:1})],64))}};export{Dr as default};
